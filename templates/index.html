<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Page Replacement Simulator</title>
    <style>
      body {
        font-family: "Segoe UI", "Roboto", sans-serif;
        margin: 0;
        padding: 0;
        background: #f1f5f9;
        color: #1e293b;
        text-align: center;
      }

      h2 {
        color: #1e293b;
        margin-top: 30px;
        font-size: 28px;
      }

      .container {
        display: flex;
        justify-content: center;
        margin: 0 auto;
        padding: 20px;
      }

      #controls,
      #frames,
      #status,
      #graph {
        margin-top: 30px;
        padding: 20px;
      }

      #controls {
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        max-width: 600px;
        margin: 0 auto;
      }

      select,
      input {
        padding: 10px 14px;
        border-radius: 8px;
        border: 1px solid #cbd5e1;
        margin: 10px;
        font-size: 16px;
        transition: border 0.2s ease;
      }

      select:focus,
      input:focus {
        outline: none;
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
      }

      .btn {
        padding: 10px 20px;
        margin: 10px 5px;
        cursor: pointer;
        border-radius: 8px;
        border: none;
        font-size: 16px;
        background-color: #6366f1;
        color: white;
        transition: background-color 0.3s ease;
      }

      .btn:hover {
        background-color: #4f46e5;
      }

      #frames-container {
        display: flex;
        justify-content: center;
        margin-top: 20px;
      }

      #frames {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .frame {
        border: 2px solid #475569;
        padding: 18px;
        width: 50px;
        height: 50px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        background-color: #f8fafc;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
      }

      .frame:hover {
        transform: scale(1.05);
      }

      .fault {
        background-color: #fecaca !important;
        border-color: #f87171;
      }

      .hit {
        background-color: #bbf7d0 !important;
        border-color: #4ade80;
      }

      #graph {
        width: 60%;
        margin: 0 auto;
        padding-bottom: 300px;
      }

      @media (max-width: 600px) {
        .frame {
          width: 50px;
          height: 50px;
          font-size: 18px;
        }

        .btn,
        select,
        input {
          font-size: 14px;
          padding: 8px 12px;
        }
      }
    </style>
  </head>
  <body>
    <h2>Page Replacement Simulator</h2>

    <div class="container">
      <div>
        <div id="controls">
          <label>Reference String:</label>
          <input
            id="refString"
            type="text"
            size="40"
            value="0 2 1 0 3 2 4 0 2 1 3 4"
          />
          <br />
          <label>Frames:</label>
          <input id="frameCount" type="number" min="1" max="10" value="4" />
          <br />
          <label>Algorithm:</label>
          <select id="algorithm">
            <option value="FIFO">FIFO</option>
            <option value="LRU">LRU</option>
            <option value="OPT">Optimal</option>
          </select>
          <br />
          <button class="btn" onclick="startSimulation()">Start</button>
          <button class="btn" onclick="prevStep()">Previous</button>
          <button class="btn" onclick="nextStep()">Next</button>
        </div>

        <div id="status"></div>
        <div id="frames-container">
          <div id="frames"></div>
        </div>
      </div>
      <canvas id="graph"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      let steps = [];
      let currentStep = 0;
      let totalFaults = 0;

      function startSimulation() {
        currentStep = 0;
        document.getElementById("frames").innerHTML = "";
        document.getElementById("status").textContent = "Simulating...";

        const refString = document.getElementById("refString").value;
        const frames = document.getElementById("frameCount").value;
        const algo = document.getElementById("algorithm").value;

        fetch("/simulate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            reference_string: refString,
            frames: frames,
            algorithm: algo,
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            steps = data.steps;
            totalFaults = data.faults;
            showStep();
            updateGraph();
          });
      }

      function showStep() {
        if (currentStep < 0) currentStep = 0;
        if (currentStep >= steps.length) currentStep = steps.length - 1;

        const step = steps[currentStep];
        const framesDiv = document.getElementById("frames");
        framesDiv.innerHTML = "";

        step.frames.forEach((page) => {
          const div = document.createElement("div");
          div.className = "frame";
          div.textContent = page === null ? "" : page;
          if (step.page_fault) {
            div.classList.add("fault");
          } else {
            div.classList.add("hit");
          }
          framesDiv.appendChild(div);
        });

        document.getElementById("status").innerHTML = `<h4><p>Step ${
          currentStep + 1
        } / ${steps.length}</p> <br />
     Accessing Page <b>${step.page} â€” 
     <span class="${step.page_fault ? "fault-status" : "hit-status"}">${
          step.page_fault ? "Page Fault" : "Hit"
        }</span></b> | 
     Total Faults: ${totalFaults}</h4>`;
      }

      function nextStep() {
        if (currentStep < steps.length - 1) {
          currentStep++;
          showStep();
        }
      }

      function prevStep() {
        if (currentStep > 0) {
          currentStep--;
          showStep();
        }
      }

      function updateGraph() {
        const ctx = document.getElementById("graph").getContext("2d");
        const labels = steps.map((s, i) => i + 1);
        const faults = steps.map((s) => (s.page_fault ? 1 : 0));
        const hits = steps.map((s) => (s.page_fault ? 0 : 1));

        new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Page Faults",
                data: faults,
                backgroundColor: "#ffb8b8",
                borderColor: "red",
                borderWidth: 3,
                // borderRadius: 10,
                borderSkipped: false,
              },
              {
                label: "Page Hits",
                data: hits,
                backgroundColor: "#b3fcce",
                borderColor: "green",
                borderWidth: 3,
                // borderRadius: 10,
                borderSkipped: false,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true },
              title: {
                display: true,
                text: "Virtual Memory Management Simulator Chart",
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  stepSize: 1,
                  callback: (value) => (value === 1 ? "Fault" : "Hit"),
                },
              },
            },
          },
        });
      }
    </script>
  </body>
</html>
